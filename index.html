<script>
(function(){
  const urls = [
    "https://iqamah.lancasterisoc.org/",
    "https://posters.lancasterisoc.org/"
  ];

  const qs = new URLSearchParams(location.search);
  const durationMs = Math.max(5, +(qs.get('t')||60)) * 1000;

  const frame = document.getElementById("frame");
  let i = 0, rotateTimer = null, loadGuard = null;

  function next(){
    i = (i + 1) % urls.length;
    load(urls[i]);
  }

  function scheduleNext(){
    clearTimeout(rotateTimer);
    rotateTimer = setTimeout(next, durationMs); // full 60s after load
  }

  function load(url){
    clearTimeout(loadGuard);
    clearTimeout(rotateTimer);

    frame.classList.remove("ready");
    frame.src = "about:blank";

    requestAnimationFrame(() => {
      frame.addEventListener("load", () => {
        clearTimeout(loadGuard);        // cancel the skip timer
        frame.classList.add("ready");
        scheduleNext();                 // start 60s countdown now
      }, { once:true });

      // guard: if site never loads, skip after 12s
      loadGuard = setTimeout(() => next(), 12000);
      frame.src = url;
    });
  }

  // pause if kiosk window hidden, resume with full interval
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) clearTimeout(rotateTimer);
    else scheduleNext();
  });

  // auto refresh daily
  function msToMidnight(){
    const n=new Date(), x=new Date(n); x.setHours(24,0,0,0);
    return x-n+5000;
  }
  setTimeout(()=>location.reload(), msToMidnight());

  load(urls[0]);
})();
</script>
